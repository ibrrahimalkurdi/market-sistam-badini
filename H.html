‏<!DOCTYPE html>
‏<html lang="ku" dir="rtl">
‏<head>
‏    <meta charset="UTF-8">
‏    <meta name="viewport" content="width=device-width, initial-scale=1.0">
‏    <title>سیستەما dawî ya مارکێتێ</title>
    
‏    <style>
‏        :root {
‏            --primary-color: #005f73; --secondary-color: #0a9396; --accent-color: #94d2bd;
‏            --danger-color: #ae2012; --success-color: #2a9d8f; --background-color: #edf2f4;
‏            --card-bg: #ffffff; --text-color: #2b2d42; --border-radius: 12px;
‏            --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
‏        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
‏        body { font-family: 'Vazirmatn', -apple-system, sans-serif; margin: 0; background-color: var(--background-color); color: var(--text-color); line-height: 1.7; }
‏        header { background-color: var(--primary-color); color: white; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
‏        header h1 { margin: 0; font-size: 1.6rem; }
‏        .tabs { display: flex; gap: 0.5rem; }
‏        .tab-btn { background-color: var(--secondary-color); color: white; border: none; padding: 0.7rem 1.2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: all 0.3s; }
‏        .tab-btn:hover { background-color: var(--accent-color); color: var(--primary-color); }
‏        .tab-btn.active { background-color: white; color: var(--primary-color); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
‏        main { padding: 2rem; max-width: 1200px; margin: auto; }
‏        .view { display: none; }
‏        .view.active { display: block; animation: fadeIn 0.5s ease; }
‏        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
‏        h2 { border-bottom: 3px solid var(--secondary-color); padding-bottom: 0.5rem; margin-bottom: 2rem; }
        
‏        /* --- Beşê Skanerê ya bi QuaggaJS --- */
‏        #scanner-view { text-align: center; }
‏        #interactive.viewport { position: relative; width: 100%; max-width: 600px; margin: auto; border-radius: var(--border-radius); box-shadow: var(--box-shadow); overflow: hidden; }
‏        #interactive.viewport video, #interactive.viewport canvas { width: 100%; height: auto; }
‏        #interactive.viewport canvas.drawingBuffer { position: absolute; top: 0; left: 0; }
        
‏        .scanner-controls { margin: 1.5rem 0; }
‏        .btn { background-color: var(--secondary-color); color: white; border: none; padding: 0.8rem 1.8rem; font-size: 1.1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s; margin: 0 0.5rem; }
‏        .btn.btn-danger { background-color: var(--danger-color); }
‏        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
‏        #scan-status { font-weight: bold; color: var(--primary-color); min-height: 24px; }
        
‏        #result-container { background-color: var(--card-bg); padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--box-shadow); margin: 1.5rem auto; max-width: 600px; text-align: right; border-right: 7px solid var(--accent-color); }
‏        #result-container.not-found { border-right-color: var(--danger-color); }
‏        #result-container p { margin: 0.5rem 0; font-size: 1.3rem; }
‏        #result-container strong { color: var(--primary-color); }
‏        #product-price-result { font-weight: bold; font-size: 2rem; color: var(--success-color); }

‏        /* ... Stîlên din wek berê ... */
‏        .admin-layout { display: grid; grid-template-columns: 1fr; gap: 2rem; } @media (min-width: 992px) { .admin-layout { grid-template-columns: 400px 1fr; } }
‏        .admin-section { background-color: var(--card-bg); padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--box-shadow); } .form-group { margin-bottom: 1.5rem; } .form-group label { display: block; margin-bottom: 0.5rem; font-weight: bold; } .form-group input { width: 100%; padding: 0.9rem; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem; } .form-group input:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px rgba(0, 95, 115, 0.2); } #add-product-form button { width: 100%; margin-top: 1rem; }
‏        #product-list-container table { width: 100%; border-collapse: collapse; margin-top: 1rem; } #product-list-container th, #product-list-container td { padding: 1rem; border-bottom: 1px solid #ddd; text-align: right; } #product-list-container th { background-color: #f8f9fa; font-weight: bold; } .delete-btn { background-color: transparent; color: var(--danger-color); border: none; font-size: 1.5rem; cursor: pointer; transition: transform 0.2s; } .delete-btn:hover { transform: scale(1.2); }
‏        #toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: var(--success-color); color: white; padding: 1rem 2rem; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: bottom 0.5s ease; z-index: 1000; } #toast.danger { background-color: var(--danger-color); } #toast.show { bottom: 30px; }
‏    </style>
‏</head>
‏<body>
‏    <header>
‏        <h1>سیستەما مارکێتێ</h1>
‏        <nav class="tabs">
‏            <button class="tab-btn active" data-view="scanner-view">سکانەر</button>
‏            <button class="tab-btn" data-view="admin-view">رێڤەبەری</button>
‏        </nav>
‏    </header>

‏    <main>
‏        <section id="scanner-view" class="view active">
‏            <h2>خواندنا بارکۆدێ</h2>
‏            <div id="interactive" class="viewport"></div>
‏            <p id="scan-status"></p>
‏            <div class="scanner-controls">
‏                <button id="start-scanner-btn" class="btn">Destpêkirina Skanerê</button>
‏                <button id="stop-scanner-btn" class="btn btn-danger" disabled>Rawestandina Skanerê</button>
‏            </div>
‏            <div id="result-container" style="display:none;">
‏                <p><strong>ناڤ:</strong> <span id="product-name-result"></span></p>
‏                <p><strong>بها:</strong> <span id="product-price-result"></span></p>
‏            </div>
‏        </section>

‏        <section id="admin-view" class="view">
‏            <div class="admin-layout">
‏                <div class="admin-section"><h2>زێدەکرنا بەرهەمەکێ نوی</h2><form id="add-product-form"><div class="form-group"><label for="barcode">ژمارا بارکۆدی:</label><input type="number" id="barcode" required placeholder="بارکۆدێ بنڤیسە یان سکان بکە"></div><div class="form-group"><label for="product-name">ناڤێ بەرهەمی:</label><input type="text" id="product-name" required placeholder="بۆ نموونە: رۆنێ زەیتونێ"></div><div class="form-group"><label for="product-price">بها (ب دیناری):</label><input type="number" id="product-price" required placeholder="بۆ نموونە: 4500"></div><button type="submit" class="btn">تۆمارکرن</button></form></div>
‏                <div class="admin-section"><h2>لیستا بەرهەمان</h2><div id="product-list-container"></div></div>
‏            </div>
‏        </section>
‏    </main>

‏    <div id="toast"></div>
    
‏    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    
‏    <script>
‏    document.addEventListener('DOMContentLoaded', () => {
‏        // ... Beşên din wek berê ne (admin, tabs, toast, hwd.) ...
‏        const tabs = document.querySelectorAll('.tab-btn'); const views = document.querySelectorAll('.view'); const toast = document.getElementById('toast'); const resultContainer = document.getElementById('result-container'); const scanStatus = document.getElementById('scan-status'); const addProductForm = document.getElementById('add-product-form'); const productListContainer = document.getElementById('product-list-container');
‏        let products = JSON.parse(localStorage.getItem('market_products_final')) || [];
‏        const saveProducts = () => { localStorage.setItem('market_products_final', JSON.stringify(products)); };
‏        tabs.forEach(tab => { tab.addEventListener('click', () => { tabs.forEach(t => t.classList.remove('active')); tab.classList.add('active'); const viewId = tab.getAttribute('data-view'); views.forEach(v => { v.classList.remove('active'); if (v.id === viewId) v.classList.add('active'); }); if (viewId !== 'scanner-view') { stopScanner(); } }); });
‏        function showToast(message, type = 'success') { toast.textContent = message; toast.className = type; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }
‏        function renderAdminList() { productListContainer.innerHTML = ''; if (products.length === 0) { productListContainer.innerHTML = '<p>هێشتا چ بەرهەم نەهاتینە تۆمارکرن.</p>'; return; } const table = document.createElement('table'); table.innerHTML = `<thead><tr><th>بارکۆد</th><th>ناڤ</th><th>بها</th><th></th></tr></thead><tbody>${products.map(p => `<tr><td>${p.barcode}</td><td>${p.name}</td><td>${parseInt(p.price).toLocaleString()} <small>دینار</small></td><td><button class="delete-btn" data-barcode="${p.barcode}">&#10005;</button></td></tr>`).join('')}</tbody>`; productListContainer.appendChild(table); }
‏        addProductForm.addEventListener('submit', e => { e.preventDefault(); const barcode = document.getElementById('barcode').value, name = document.getElementById('product-name').value, price = document.getElementById('product-price').value; if (products.find(p => p.barcode === barcode)) { showToast('ئەڤ بارکۆدە بەری نوکە هاتیە تۆمارکرن!', 'danger'); return; } products.push({ barcode, name, price }); saveProducts(); renderAdminList(); addProductForm.reset(); showToast('بەرهەم ب سەرکەفتی هـاتە زێـدەکرن'); });
‏        productListContainer.addEventListener('click', e => { if (e.target.classList.contains('delete-btn')) { const barcodeToDelete = e.target.getAttribute('data-barcode'); products = products.filter(p => p.barcode !== barcodeToDelete); saveProducts(); renderAdminList(); showToast('بەرهەم هاتە ژێبرن', 'danger'); } });

‏        // --- LOJÎKA SKANERÊ YA BI QUAGGAJS ---
‏        const startBtn = document.getElementById('start-scanner-btn');
‏        const stopBtn = document.getElementById('stop-scanner-btn');
‏        let isScannerRunning = false;

‏        function startScanner() {
‏            Quagga.init({
‏                inputStream: { name: "Live", type: "LiveStream", target: document.querySelector('#interactive') },
‏                decoder: { readers: ["ean_reader", "code_128_reader", "upc_reader", "code_39_reader"] }
‏            }, (err) => {
‏                if (err) { console.log(err); scanStatus.textContent = "خەلەتی: نەشیا کامیرێ ڤەکەت."; return; }
‏                Quagga.start();
‏                isScannerRunning = true;
‏                startBtn.disabled = true;
‏                stopBtn.disabled = false;
‏                scanStatus.textContent = "ل بارکۆدی بگەره...";
            });
        }

‏        function stopScanner() {
‏            if (isScannerRunning) {
‏                Quagga.stop();
‏                isScannerRunning = false;
‏                startBtn.disabled = false;
‏                stopBtn.disabled = true;
‏                scanStatus.textContent = "";
            }
        }
        
‏        startBtn.addEventListener('click', startScanner);
‏        stopBtn.addEventListener('click', stopScanner);

‏        Quagga.onProcessed((result) => {
‏            const drawingCtx = Quagga.canvas.ctx.overlay;
‏            const drawingCanvas = Quagga.canvas.dom.overlay;
‏            if (result) {
‏                if (result.boxes) {
‏                    drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
‏                    result.boxes.filter(box => box !== result.box).forEach(box => {
‏                        Quagga.ImageDebug.drawPath(box, { x: 0, y: 1 }, drawingCtx, { color: "green", lineWidth: 2 });
                    });
                }
‏                if (result.box) { Quagga.ImageDebug.drawPath(result.box, { x: 0, y: 1 }, drawingCtx, { color: "#00F", lineWidth: 2 }); }
‏                if (result.codeResult && result.codeResult.code) { Quagga.ImageDebug.drawPath(result.line, { x: 'x', y: 'y' }, drawingCtx, { color: 'red', lineWidth: 3 }); }
            }
        });

‏        Quagga.onDetected((result) => {
‏            const code = result.codeResult.code;
‏            scanStatus.textContent = `بارکۆد هاتە دیتن: ${code}`;
            
‏            const product = products.find(p => p.barcode === code);
‏            resultContainer.style.display = 'block';
‏            resultContainer.classList.remove('not-found');

‏            if (product) {
‏                document.getElementById('product-name-result').textContent = product.name;
‏                document.getElementById('product-price-result').textContent = `${parseInt(product.price).toLocaleString()} دینار`;
‏            } else {
‏                resultContainer.classList.add('not-found');
‏                document.getElementById('product-name-result').textContent = 'بەرهەم د سیستەمی دا نینە';
‏                document.getElementById('product-price-result').textContent = `بارکۆد: ${code}`;
            }
            
‏            stopScanner();
‏            setTimeout(() => { resultContainer.style.display = 'none'; }, 5000); // Piştî 5 çirkeyan encamê veşêre
        });

‏        renderAdminList();
    });
‏    </script>
‏</body>
‏</html>
